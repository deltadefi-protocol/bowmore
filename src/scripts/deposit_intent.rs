use whisky::{
    data::{byte_string, integer, Address, ByteString, Int, List, Map, OutputReference, Value},
    Asset, ConstrEnum, WError,
};

#[derive(Debug, Clone, ConstrEnum)]
pub enum IntentRedeemer {
    MintIntent,
    BurnIntent(List<Int>, ByteString, List<ByteString>),
}

#[derive(Debug, Clone, ConstrEnum)]
pub enum SignedMessage {
    Message(Int, Map<(ByteString, ByteString), Int>, OutputReference),
}

impl SignedMessage {
    pub fn from_plutus_data(message: &str) -> Result<Self, WError> {
        let plutus_data = whisky::csl::PlutusData::from_hex(message).map_err(|_e| {
            WError::new(
                "Failed to decode message as Plutus data",
                "InvalidMessageError",
            )
        })?;

        let datum_json = whisky::csl::decode_plutus_datum_to_json_value(
            &plutus_data,
            whisky::csl::PlutusDatumSchema::DetailedSchema,
        )
        .map_err(|_err| {
            WError::new("Failed to decode Plutus datum to JSON", "InvalidDatumError")
        })?;

        let fields = datum_json["fields"]
            .as_array()
            .ok_or_else(|| WError::new("Invalid SignedMessage structure", "InvalidDataError"))?;

        let vault_balance_int = fields[0]["int"]
            .as_i64()
            .ok_or_else(|| WError::new("Missing vault balance message", "InvalidDataError"))?;
        let vault_balance = Int::new(vault_balance_int as i128);

        let prices_map_json = &fields[1]["map"];
        let prices_array = prices_map_json
            .as_array()
            .ok_or_else(|| WError::new("Invalid prices map structure", "InvalidDataError"))?;

        let mut prices_map = Map::new(&[]);
        for entry in prices_array {
            let policy_id_byte = entry["k"]["list"][0]["bytes"].as_str().ok_or_else(|| {
                WError::new("Invalid policy ID in prices map", "InvalidDataError")
            })?;
            let asset_name_byte = entry["k"]["list"][1]["bytes"].as_str().ok_or_else(|| {
                WError::new("Invalid asset name in prices map", "InvalidDataError")
            })?;
            let value_int = entry["v"]["int"].as_i64().ok_or_else(|| {
                WError::new("Invalid price value in prices map", "InvalidDataError")
            })?;

            let key = (
                ByteString::new(policy_id_byte),
                ByteString::new(asset_name_byte),
            );
            let value = Int::new(value_int as i128);

            prices_map.insert(key, value);
        }

        let tx_hash = fields[2]["fields"][0]["bytes"]
            .as_str()
            .ok_or_else(|| WError::new("Missing tx hash in UTXO reference", "InvalidDataError"))?;

        let output_index = fields[2]["fields"][1]["int"].as_i64().ok_or_else(|| {
            WError::new("Missing output index in UTXO reference", "InvalidDataError")
        })?;

        let tx_hash_bytes = ByteString::new(tx_hash);
        let output_index_int = Int::new(output_index as i128);

        let utxo_ref_data = Box::new((tx_hash_bytes, output_index_int));
        let utxo_ref = OutputReference::new(utxo_ref_data);

        Ok(SignedMessage::Message(vault_balance, prices_map, utxo_ref))
    }
}

#[derive(Debug, Clone, ConstrEnum)]
pub enum DepositIntentDatum {
    Datum(Address, Value),
}

impl DepositIntentDatum {
    pub fn new(assets: &[Asset], address: &str) -> Self {
        let m_value = Value::from_asset_vec(assets);
        let w_address = whisky::deserialize_address(address);

        let (payment_key_hash, is_script_payment_key) = if w_address.pub_key_hash.is_empty() {
            (w_address.script_hash, true)
        } else {
            (w_address.pub_key_hash, false)
        };

        let (stake_key_hash, is_script_stake_key) = if w_address.stake_key_hash.is_empty() {
            (w_address.stake_key_script_hash, true)
        } else {
            (w_address.stake_key_hash, false)
        };

        let address_datum = Address::new(
            &payment_key_hash,
            Some(&stake_key_hash),
            is_script_payment_key,
            is_script_stake_key,
        );

        DepositIntentDatum::Datum(address_datum, m_value)
    }
}

use whisky::{
    utils::blueprint::{MintingBlueprint, SpendingBlueprint},
    BuilderDataType, LanguageVersion,
};

use crate::config::AppConfig;
use crate::scripts::plutus_loader::get_compiled_code_by_index;

pub fn deposit_intent_mint_blueprint(
    oracle_nft: &str,
    lp_decimal: i128,
) -> Result<MintingBlueprint, whisky::WError> {
    let mut blueprint = MintingBlueprint::new(LanguageVersion::V3);
    let compiled_code = "5920010101002229800aba4aba2aba1aba0aab9faab9eaab9dab9cab9a9bae0039bad00248888888888a60022a660089215665787065637420696e7075745f646174756d3a204465706f736974496e74656e74446174756d203d0a2020202020202020202020202020202020202020696e7075745f696e6c696e655f646174756d28696e7075742900168a9980224967657870656374207661756c745f6f7261636c655f6f75747075745f646174756d3a205661756c744f7261636c65446174756d203d0a202020202020202020206f75747075745f696e6c696e655f646174756d287661756c745f6f7261636c655f6f75747075742900168a9980224947657870656374205b7661756c745f6f7261636c655f6f75747075745d203d206f7574707574735f776974685f706f6c696379286f7574707574732c206f7261636c655f6e66742900168a9980224953657870656374204d657373616765207b207661756c745f62616c616e63652c207072696365732c207574786f5f726566207d3a204d657373616765203d0a202020202020202020207369676e65645f6461746100168a9980224964657870656374207661756c745f6f7261636c655f696e7075745f646174756d3a205661756c744f7261636c65446174756d203d0a20202020202020202020696e7075745f696e6c696e655f646174756d287661756c745f6f7261636c655f696e7075742900168a998022491872656465656d65723a20496e74656e7452656465656d657200164888889660026464653001300e3754003370e90014c04800e602400491112cc004c00c0122646644944c05c004c05cc060004c04cdd5002c4c966002600200b13259800801c4c8cc8966002600a003159800980c1baa00680140350194566002601000313259800800c03a264b3001001807c03e26644b3001001808c4c966002003012809404a0251332259800800c052264b300100180ac056264b30013025003899806003912cc00400a26601c00644b3001002807c4c96600200301b80dc06e0371323003302b004375c0028158c0a000902644c96600200301980cc066264600660520086eb40060328148c09800902440590221bac00180ac0550251811000a040375c00260420048110c07c00501d1bac001301e002807c03d01f180e000a0343018375400d00d405480a84c8c8c8cc88ca6002603e00314a13758603e00d3758603e00b3756603e60406040008911112cc004c038c080dd5002c4c9660020030058acc004c098006264944c09400600a81190231bac302430250068cc004c084dd5002c8c094c09800644464b300130153024375400314800226eb4c0a0c094dd5000a0443259800980a98121baa0018a60103d87a8000899198008009bab30293026375400444b30010018a6103d87a8000899192cc004cdc8803000c56600266e3c0180062601e66056605200497ae08a60103d87a80004099133004004302d00340986eb8c09c004c0a8005028204432330010010042259800800c5300103d87a8000899192cc004cdc8803000c56600266e3c0180062601c66054605000497ae08a60103d87a80004095133004004302c00340946eb8c098004c0a400502748896600266e2400920008800c6600200733708004900a4cdc599b803370a004900a240c0002801902148888c8cc004004014896600200310058992cc004006266008605600400d133005302b0023300300300140a4605600281426e0120019b964910447473a20004888888a6002605800f3758605600f3259800980b18141baa0018981618149baa0018a99813a49b765787065637420536f6d65286f7261636c655f696e70757429203d0a20202020696e707574730a2020202020207c3e206c6973742e66696e64280a20202020202020202020666e287265665f696e7075743a20496e70757429207b0a2020202020202020202020207175616e746974795f6f66287265665f696e7075742e6f75747075742e76616c75652c206f7261636c655f6e66742c20222229203d3d20310a202020202020202020207d2c0a20202020202020202900164098646600200201644b30010018a60103d87a80008992cc004c06e60026eacc024c0acdd5180498159baa001813d221004021130113302d0014bd7044cc00c00cc0bc0090281816800a0569802002244446465300130010019bac303130320069bae303100648894cc0bcc028dcc99801803a45001323259800800c4ca600200513322323232323298009bad303e0019bae303e303f303f303f303f001cc00488896600266e20009203089800801456600266e1c0092030899802240044600400315980099b88002480e226600666e3922103020408003370000490189180119bca4a2003124bded8c10140000101200040f081e103c488888ca600200300380120022225980099b89002480022600297ae08919194c00401a604000b23005330490020019bad3046002401860880033001009804400500720809b87483f80e4466ec0008dd4000cdc6805a44444664464b300130300048a60103d87a80008992cc006600260626eb4c1100069429450414530103d87a800089815198231821800a5eb810414c004006440032225980099b8900148002297bdb18010140000101200089980119b8e0163370200e00266e0400400d04348896600266e2400520008a5ef6c601014000010120008998014c004cdc0803800c00e02cb8c19b81001003410d0044004820088cc004888c8c8cdd8191ba73304c30490013304c304a0014bd7019bb030480023048001304900198008034880060090039bad30480014019300100591000c00e0050014014446600490011192cc004cdc4800a4009159800981a800c6600200900380148c02cdd4000a01a8acc004c0e000633001004801ccdc00012407f2300b3750604666e052000001403515980099b87002482f80626466002002460186ea400488cc01920022598009807000c4c009221008cc00401e00d33700002903fc8cc0100108c010cdc5001000a014412119800802400e66e00009207f918059ba9001401c8229045208a8acc004cdc3800a401919800802400e66e0000920ff02919802a40044b30013370e004906600c492f7b63001014000010120008992cc004cdc38012417c0519800803c01a66012012440032300e3374a004002805a330010078034cdc0001241fe0329800804401e66014014440030019180799ba5003001404080810482cc004cdc4a41002800513370066e0000920ff134803a266e0000920f101411c823900d456600266e1c00520088acc004cdc38012417c0519800802400e6600c00c440032300b374e002804233001004801ccdc0001241fe0329800802c0126600e00e44003001918061ba700140348069045456600266e1c005200a8acc004cdc3801241fc0513232330010012300d374c002446600e900112cc004c03c0062600497adef6c608919194c00401a4600c660a4004003375a609e0048030c8cdd81829000982918298009bac304d0019800804c02260300028029049198030031100146600200900399b80002482fc0a464653001001801c8c038dd3000a0022225980099b89002480022600297adef6c608919194c00401a605400b23005330530020019bad305000240186466ec0c14c004c14cc150004dd61827000cc00402a01300140148250cc01c01c8800900d208a8925ef6c610140000101200041148229045208a337060029020111119198008008011119803240044b3001300a0018980125eb8224646530010069180319826801000cdd69825001200c30480019800804401e6026002803104411114c00401200700291980200091801800a0124dd7181f003cdd6181f002cdd6981f0024dd6981f001cdd6981f001244444444b300130303042375400d13259800800c566002606260866ea8006264b300100181e44c96600200303d81ec0f626644b300100181fc4c966002003040899912cc00400608513259800800c56600260a0005133037003225980080145660026076609a6ea800e264b300100182344c966002003047823c11e08f1332259800800c126264b3001001825412a09513259800982c001c4c8c8c8ca60026eb4c16c0066eb4c16cc1700066eacc16c009222533059303437326605a6ea0cdc000100da45001533059303437326605a6ea0cdc01803803001a441001533059303437326605a6ea0cdc0010001a4410013259800800c152264b300130610028992cc004006330010018acc0056600266ebc004c8c8c8c8c8c124cc194c198014cc194c198010cc194c19800ccc194dd419b8002300a33065375066e00c03c03802ccc194c198008cc194c198004cc194dd419b8002800b30673067001306600130653065306500130640013063001305e375405914a3153305c491277661756c745f6f7261636c655f6f75747075745f646174756d5f636865636b203f2046616c73650014a082da2b3001302d3259800800c520008991815992cc00400a2900044c0b0cc004004c194009062112cc0040062900044c0b4cc008008c1980050631831800a0c032330010013756607a60be6ea800c896600200314bd7044c8cc88c8cc004004dd59832002112cc004006200713233068374e660d06ea4014cc1a0c194004cc1a0c1980052f5c06600600660d400460d00028330dd718300009980180198328011831800a0c28a518a9982e24812a69735f7661756c745f6f7261636c655f6f75747075745f76616c75655f636c65616e203f2046616c73650014a082da294105b415d02b415e0af05782ba0c632598009816982e9baa00189830982f1baa0018a9982e24812c65787065637420496e6c696e65446174756d287261775f646174756d29203d206f75747075742e646174756d0016416c60c060c260c260ba6ea80060aa82f0c17c00505d1919800800821912cc004006297ae0899912cc004c8cc004004c8cc004004dd59832183298309baa0042259800800c52f5c113233223233001001375660cc00844b30010018801c4c8cc1a8dd3998351ba90053306a30670013306a30680014bd701980180198360011835000a0d0375c60c40026600600660ce00460ca0028318896600200314a115980099b8f375c60c86eb0c190004176294626600400460ca00282f106244cc184008cc01001000626600800800282e0c180004c18400505e0c16c006600244464b300130470018992cc00400600713259800800c01200900480244c96600260c2007006802a0bc375c0028308c17800505c182d1baa0048acc004c128006264b3001001801c4c9660020030048024012009132598009830801c01a00a82f0dd7000a0c2305e001417060b46ea801200482b9057182c1baa003912cc004006297adef6c6089919911919800800998030031830002912cc0040062660be66ec0dd48021ba80034bd6f7b63044ca60026eb8c1740066eb4c17800660c40049112cc004cdc8004001c4cc18ccdd81ba9008375000e00b15980099b8f00800389983199bb037520106ea001c0062660c666ec0dd48019ba800233006006001417882f060c000282f0dd7182c0009bad3059001305b00141652259800800c52f5bded8c1132332232330010013300600630600052259800800c4cc17ccdd81ba9004374c00697adef6c608994c004dd7182e800cdd5982f000cc1880092225980099b9000800389983199bb037520106e9801c0162b30013371e010007133063337606ea4020dd3003800c4cc18ccdd81ba9003374c0046600c00c00282f105e0c18000505e1bae3058001375660b200260b600282ca444653001001802400d0011112cc00400a200319800801cc18000a6600860be004002801905d48896600200514c103d87a80008acc004c1180062607e660b660b800497ae08cc00400e60ba0053033001400c82b105a244444664530012300300191801000cc00c00d222329800800c10e0714bd6f7b63052000a400080088888896600200b15980080244cc1a0dd3001998341ba800233068375000297ae08a998322492e4261746368206465706f73697420696e74656e74205554784f73206e6f742066756c6c792070726f6365737365640016419d13322332259800982d18349baa0018acc004cdc79bae306d306a37540020ad159800804454cc1a1241234d6f7265205554784f7320617265207370656e74207468616e20737065636966696564001689919912cc004c168c1b0dd500144cc8966002003159800982e18371baa0018992cc0040060d513259800800c4c96600200306c8992cc0040060db13259800983c001c4c96600260c460e86ea8016264b300100183844c96600200313259800800c1ca264b30010018acc004c1f400a330010038992cc004c19c006264b300100183ac4c96600200315980098400080144c96600260d400313259800800c1e2264b30010018acc004c20c0400a33001001805c1e502941e50800141e60f307983ca1080230810100141fc60fa6ea800a2b3001306d0018992cc0040060f113259800800c1e60f3079899912cc0040060f713259800800c1f20f907c899912cc0040060fd13259800800c1fe0ff07f8992cc004c2280400e02508001421c046eb40060fe845008c21c04005085011bad00130860100283e210e023084010014208046eb4004c20c0400a0f2842008c2040400507f183e9baa00283ba0f441e860f66ea80060ec83ea0ed07683b41d908101183f000a0f8307a37540051598009835000c56600260f46ea800a00d07441ed07441dc83b8c1e0dd5000c1cd02341cd07a41ce0e7073839a0fc307b00141e460f6005071838c1c60e283e0c1e4005077183a9baa005837a0e413305f001225980080144c8c8c8c966002b30013370f3001375660b060f46ea803607d488100415c00313375e60fa60f46ea8034c1f4012294107746600201d329800800cc074062603a008800888966002005100189919914c00401a61080200b32330010010052259800800c4cc21004cdd81ba9004374c00697adef6c608994c004dd7184100800cdd5984180800cc21c040092225980099b900080038998440099bb037520106e9801c0162b30013371e01000713259800983a1843009baa0018998448099bb03752012611402610e026ea800400a2004842008c1b0cc22004dd3194c0040066054011302a0034004444b30010028800c4c8cc8a600200d3090010059919800800802912cc0040062661200266ec0dd48021ba80034bd6f7b63044ca60026eb8c238040066eb4c23c040066126020049112cc004cdc8004001c4cc25004cdd81ba9008375000e00b15980099b8f0080038992cc004c20004c24804dd5000c4cc25404cdd81ba90093096013093013754002005100242400460f066128026ea0cdc000380125eb822661280266ec0dd48019ba800233006006001423c048478086122020028478090061bae308901001375a6114020026118020048450092f5c113308801337606ea400cdd300119803003000a10602420c04308501001420c048030dd7183e8009bab307e00130800100241f93370002c0053370000202a80922a660f092011f4465706f73697420696e74656e74206f757470757420696e636f7272656374001641dcb30013066039899b82001074899b8333704002072604a04883b2600200348002453001375660f400500191192cc004c1a8c1f0dd5000c4cdc000119b82375a61000260fa6ea8004dd6983e801c54cc1ed2416b65787065637420536f6d6528707269636529203d0a2020202020202020202020207072696365730a20202020202020202020202020207c3e2070616972732e6765745f66697273742828706f6c6963795f706169722e3173742c2061737365745f706169722e3173742929001641e864646600200206a44b30010018a60103d87a80008992cc004cdd79ba7004307f001898331984100984000800a5eb8226600600661080200483e8c20804005080011983f183d8021983f183d80125eb81021203e375660f460f600260ec6ea802226464b300100183941ca0e5072899912cc0040060e9133065375600244b30010028980398400080444c8c96600200307883c41e20f11332259800800c1ea0f507a89918031842808039bad00183d210a02375c00260fc004841808c1f0004c1fc00907d41d20e907441fc6eb8004c1e000907d183b000983c80120ee83720ea375600306d836c1b5078183a800a0e63075002835c1ae0d706b41d860e60028388c1bcdd5000c1a506c41a60d3069834a0e83070306d375400464b3001303d306d375400313071306e3754003153306c49013265787065637420496e6c696e65446174756d287261775f646174756d29203d20696e7075742e6f75747075742e646174756d001641ac60e060e260e260da6ea8c1c0c1c4c1b4dd5003c54cc1ad24013865787065637420536f6d65286f75745f7574786f29203d206f757470757473207c3e206c6973742e6174286f75747075745f696e64657829001641a8660180a400260de0126eb4c1b402106b466002011007803401500220ce8cc00402200f006802a004419c4445300100c802c012007002800a018306b3068375460d660d06ea8c118c1a0dd500118348029835002a0ce1802002180180196600266e2403c0522900044cdc199b82300101401348320050521b8100e825a0aa375a00304a416060aa0028298dd7000982a00120aa30520014140609c6ea800e08a825a26464b3001001823c11e26644b3001001824c12609313259800801c12a264b3001001825c12e09704b899912cc00400609b13259800800c13a09d04e82744c96600260b80071300b305c00c827a0b2375c00282e0c1640050571bae0013058004416460ac00682a0dd6800c1250571bac0013050002823c11d05518270009828801209e821a09a821c10e0870434144609c0028260dd580098268014102081040413860960028248dd6800982500140f504b1824000a08c3044375400303b410503b81dc0ee0768248c118c10cdd5003454cc1052413465787065637420536f6d65287369676e65645f6461746129203d2063626f722e646573657269616c697365286d6573736167652900164100303e303e001303d001303c001303b001303a303a002303437540046e0120028152002222598009811981a9baa0038992cc00400600513259800800c00e007003801c4cc89660020030058992cc00400600d006803401a26644b300100180444c966002003009804c4cc896600200300b8992cc00400601900c80644cc896600200300e8992cc00400601f00f807c4cc89660020030118992cc00400602501280944cc89660020030148992cc00400602b01580ac05626644b300100180bc4c96600200301880c406226644b300100180d44c96600200301b80dc06e0371332259800800c076264b300100180f407a03d01e899912cc00400604113259800800c086043021810c4cc89660020030238992cc0040060490248124092264b3001305e00389982280e112cc00400a05113259800800c0a205102881444c8c00cc188010dd7000a0c4305f0024175025416c6eb800505e182d800a0b2375c00260b400482d8c1600050561bae0013057002416060aa0028298dd7000982a00120aa305200141406eb4004c14400a0308290c13c00504d1bae001304e002413c60980028250dd68009825801404904c1824800a08e375a002609000500f4124608c0028220dd6800982280140310461821800a08237580026084005009804a086304000140f86eb8004c0fc009040181e800a076375c002607800481e8c0e8005038181b1baa003800a066814c0a605302940e064b30013002303237540031303630333754003153303149013265787065637420496e6c696e65446174756d287261775f646174756d29203d20696e7075742e6f75747075742e646174756d001640c0606a606c606c60646ea8c040c0c8dd50041b874801044464b30010038991919911980480119b8a488101280059800800c4cdc52441035b5d2900006899b8a489035b5f20009800800ccdc52441025d2900006914c00402a00530070014029229800805400a0028051010206c5980099b880014803a266e0120f2010018acc004cdc4000a41000513370066e01208014001480362c81810301bac3033002375a60620026466ec0dd418188009ba73032001375400713259800800c4cdc52441027b7d00003899b8a489037b5f20003232330010010032259800800c400e264b30010018994c00402a606c003337149101023a200098008054c0dc00600a805100a181c80144ca6002015303600199b8a489023a200098008054c0dc006600e66008008004805100a181c801206e303900140d866e29220102207d0000340cc6eac00e264b3001001899b8a489025b5d00003899b8a489035b5f20009800800ccdc52441015d00003914c00401e0053004001401d229800803c00a002803900d20663758007133005375a0060051323371491102682700329800800cc034dc68014cdc52450127000044004444b300133710004900044006264664530010069809002ccdc599b800025980099b88002480522903045206e40d466e2ccdc0000acc004cdc4000a402914818229037206a004401866e0c00520203370c002901019b8e00400240c86eb800d0361b8a4881022c20002232330010010032259800980e800c4cdc52450130000038acc004cdc4000a40011337149101012d0033002002337029000000c4cc014cdc2000a402866e2ccdc019b8500148051206000340b4816840783301d0093301d374e64646600200200844b30010018a5eb8226644b30015980099baf30233020375400400b1323300100132330010013756604a604c60446ea8010896600200314bd7044c8cc88c8cc004004dd59813802112cc00400620071323302b374e660566ea4014cc0acc0a0004cc0acc0a40052f5c066006006605a00460560028148dd718118009980180198140011813000a0482259800800c528456600266e3cdd718129bac302500100e8a518998010011813000a03e408d14a080ea2660440046600800800313300400400140746042002604400280f8c004cc074cdd2a40046603a6ea401d2f5c06603a980103d87a80004bd7025eb80dd6180e0009ba548000c070004c06c004c058dd5002980a9baa00422323300100100322330030013002002805402a01500a40686eb8c05cc050dd50034590111b87480010100c044c048004c044004c030dd500945268a9980524811856616c696461746f722072657475726e65642066616c7365001365640241"; // Using index 0 for deposit intent spend
    blueprint
        .param_script(
            compiled_code,
            &[
                &byte_string(oracle_nft).to_string(),
                &integer(lp_decimal).to_string(),
            ],
            BuilderDataType::JSON,
        )
        .unwrap();
    Ok(blueprint)
}

pub fn deposit_intent_spend_blueprint(
    oracle_nft: &str,
    lp_decimal: i128,
) -> Result<SpendingBlueprint, whisky::WError> {
    let AppConfig { network_id, .. } = AppConfig::new();

    let mut blueprint =
        SpendingBlueprint::new(LanguageVersion::V3, network_id.parse().unwrap(), None);
    let compiled_code = "5920010101002229800aba4aba2aba1aba0aab9faab9eaab9dab9cab9a9bae0039bad00248888888888a60022a660089215665787065637420696e7075745f646174756d3a204465706f736974496e74656e74446174756d203d0a2020202020202020202020202020202020202020696e7075745f696e6c696e655f646174756d28696e7075742900168a9980224967657870656374207661756c745f6f7261636c655f6f75747075745f646174756d3a205661756c744f7261636c65446174756d203d0a202020202020202020206f75747075745f696e6c696e655f646174756d287661756c745f6f7261636c655f6f75747075742900168a9980224947657870656374205b7661756c745f6f7261636c655f6f75747075745d203d206f7574707574735f776974685f706f6c696379286f7574707574732c206f7261636c655f6e66742900168a9980224953657870656374204d657373616765207b207661756c745f62616c616e63652c207072696365732c207574786f5f726566207d3a204d657373616765203d0a202020202020202020207369676e65645f6461746100168a9980224964657870656374207661756c745f6f7261636c655f696e7075745f646174756d3a205661756c744f7261636c65446174756d203d0a20202020202020202020696e7075745f696e6c696e655f646174756d287661756c745f6f7261636c655f696e7075742900168a998022491872656465656d65723a20496e74656e7452656465656d657200164888889660026464653001300e3754003370e90014c04800e602400491112cc004c00c0122646644944c05c004c05cc060004c04cdd5002c4c966002600200b13259800801c4c8cc8966002600a003159800980c1baa00680140350194566002601000313259800800c03a264b3001001807c03e26644b3001001808c4c966002003012809404a0251332259800800c052264b300100180ac056264b30013025003899806003912cc00400a26601c00644b3001002807c4c96600200301b80dc06e0371323003302b004375c0028158c0a000902644c96600200301980cc066264600660520086eb40060328148c09800902440590221bac00180ac0550251811000a040375c00260420048110c07c00501d1bac001301e002807c03d01f180e000a0343018375400d00d405480a84c8c8c8cc88ca6002603e00314a13758603e00d3758603e00b3756603e60406040008911112cc004c038c080dd5002c4c9660020030058acc004c098006264944c09400600a81190231bac302430250068cc004c084dd5002c8c094c09800644464b300130153024375400314800226eb4c0a0c094dd5000a0443259800980a98121baa0018a60103d87a8000899198008009bab30293026375400444b30010018a6103d87a8000899192cc004cdc8803000c56600266e3c0180062601e66056605200497ae08a60103d87a80004099133004004302d00340986eb8c09c004c0a8005028204432330010010042259800800c5300103d87a8000899192cc004cdc8803000c56600266e3c0180062601c66054605000497ae08a60103d87a80004095133004004302c00340946eb8c098004c0a400502748896600266e2400920008800c6600200733708004900a4cdc599b803370a004900a240c0002801902148888c8cc004004014896600200310058992cc004006266008605600400d133005302b0023300300300140a4605600281426e0120019b964910447473a20004888888a6002605800f3758605600f3259800980b18141baa0018981618149baa0018a99813a49b765787065637420536f6d65286f7261636c655f696e70757429203d0a20202020696e707574730a2020202020207c3e206c6973742e66696e64280a20202020202020202020666e287265665f696e7075743a20496e70757429207b0a2020202020202020202020207175616e746974795f6f66287265665f696e7075742e6f75747075742e76616c75652c206f7261636c655f6e66742c20222229203d3d20310a202020202020202020207d2c0a20202020202020202900164098646600200201644b30010018a60103d87a80008992cc004c06e60026eacc024c0acdd5180498159baa001813d221004021130113302d0014bd7044cc00c00cc0bc0090281816800a0569802002244446465300130010019bac303130320069bae303100648894cc0bcc028dcc99801803a45001323259800800c4ca600200513322323232323298009bad303e0019bae303e303f303f303f303f001cc00488896600266e20009203089800801456600266e1c0092030899802240044600400315980099b88002480e226600666e3922103020408003370000490189180119bca4a2003124bded8c10140000101200040f081e103c488888ca600200300380120022225980099b89002480022600297ae08919194c00401a604000b23005330490020019bad3046002401860880033001009804400500720809b87483f80e4466ec0008dd4000cdc6805a44444664464b300130300048a60103d87a80008992cc006600260626eb4c1100069429450414530103d87a800089815198231821800a5eb810414c004006440032225980099b8900148002297bdb18010140000101200089980119b8e0163370200e00266e0400400d04348896600266e2400520008a5ef6c601014000010120008998014c004cdc0803800c00e02cb8c19b81001003410d0044004820088cc004888c8c8cdd8191ba73304c30490013304c304a0014bd7019bb030480023048001304900198008034880060090039bad30480014019300100591000c00e0050014014446600490011192cc004cdc4800a4009159800981a800c6600200900380148c02cdd4000a01a8acc004c0e000633001004801ccdc00012407f2300b3750604666e052000001403515980099b87002482f80626466002002460186ea400488cc01920022598009807000c4c009221008cc00401e00d33700002903fc8cc0100108c010cdc5001000a014412119800802400e66e00009207f918059ba9001401c8229045208a8acc004cdc3800a401919800802400e66e0000920ff02919802a40044b30013370e004906600c492f7b63001014000010120008992cc004cdc38012417c0519800803c01a66012012440032300e3374a004002805a330010078034cdc0001241fe0329800804401e66014014440030019180799ba5003001404080810482cc004cdc4a41002800513370066e0000920ff134803a266e0000920f101411c823900d456600266e1c00520088acc004cdc38012417c0519800802400e6600c00c440032300b374e002804233001004801ccdc0001241fe0329800802c0126600e00e44003001918061ba700140348069045456600266e1c005200a8acc004cdc3801241fc0513232330010012300d374c002446600e900112cc004c03c0062600497adef6c608919194c00401a4600c660a4004003375a609e0048030c8cdd81829000982918298009bac304d0019800804c02260300028029049198030031100146600200900399b80002482fc0a464653001001801c8c038dd3000a0022225980099b89002480022600297adef6c608919194c00401a605400b23005330530020019bad305000240186466ec0c14c004c14cc150004dd61827000cc00402a01300140148250cc01c01c8800900d208a8925ef6c610140000101200041148229045208a337060029020111119198008008011119803240044b3001300a0018980125eb8224646530010069180319826801000cdd69825001200c30480019800804401e6026002803104411114c00401200700291980200091801800a0124dd7181f003cdd6181f002cdd6981f0024dd6981f001cdd6981f001244444444b300130303042375400d13259800800c566002606260866ea8006264b300100181e44c96600200303d81ec0f626644b300100181fc4c966002003040899912cc00400608513259800800c56600260a0005133037003225980080145660026076609a6ea800e264b300100182344c966002003047823c11e08f1332259800800c126264b3001001825412a09513259800982c001c4c8c8c8ca60026eb4c16c0066eb4c16cc1700066eacc16c009222533059303437326605a6ea0cdc000100da45001533059303437326605a6ea0cdc01803803001a441001533059303437326605a6ea0cdc0010001a4410013259800800c152264b300130610028992cc004006330010018acc0056600266ebc004c8c8c8c8c8c124cc194c198014cc194c198010cc194c19800ccc194dd419b8002300a33065375066e00c03c03802ccc194c198008cc194c198004cc194dd419b8002800b30673067001306600130653065306500130640013063001305e375405914a3153305c491277661756c745f6f7261636c655f6f75747075745f646174756d5f636865636b203f2046616c73650014a082da2b3001302d3259800800c520008991815992cc00400a2900044c0b0cc004004c194009062112cc0040062900044c0b4cc008008c1980050631831800a0c032330010013756607a60be6ea800c896600200314bd7044c8cc88c8cc004004dd59832002112cc004006200713233068374e660d06ea4014cc1a0c194004cc1a0c1980052f5c06600600660d400460d00028330dd718300009980180198328011831800a0c28a518a9982e24812a69735f7661756c745f6f7261636c655f6f75747075745f76616c75655f636c65616e203f2046616c73650014a082da294105b415d02b415e0af05782ba0c632598009816982e9baa00189830982f1baa0018a9982e24812c65787065637420496e6c696e65446174756d287261775f646174756d29203d206f75747075742e646174756d0016416c60c060c260c260ba6ea80060aa82f0c17c00505d1919800800821912cc004006297ae0899912cc004c8cc004004c8cc004004dd59832183298309baa0042259800800c52f5c113233223233001001375660cc00844b30010018801c4c8cc1a8dd3998351ba90053306a30670013306a30680014bd701980180198360011835000a0d0375c60c40026600600660ce00460ca0028318896600200314a115980099b8f375c60c86eb0c190004176294626600400460ca00282f106244cc184008cc01001000626600800800282e0c180004c18400505e0c16c006600244464b300130470018992cc00400600713259800800c01200900480244c96600260c2007006802a0bc375c0028308c17800505c182d1baa0048acc004c128006264b3001001801c4c9660020030048024012009132598009830801c01a00a82f0dd7000a0c2305e001417060b46ea801200482b9057182c1baa003912cc004006297adef6c6089919911919800800998030031830002912cc0040062660be66ec0dd48021ba80034bd6f7b63044ca60026eb8c1740066eb4c17800660c40049112cc004cdc8004001c4cc18ccdd81ba9008375000e00b15980099b8f00800389983199bb037520106ea001c0062660c666ec0dd48019ba800233006006001417882f060c000282f0dd7182c0009bad3059001305b00141652259800800c52f5bded8c1132332232330010013300600630600052259800800c4cc17ccdd81ba9004374c00697adef6c608994c004dd7182e800cdd5982f000cc1880092225980099b9000800389983199bb037520106e9801c0162b30013371e010007133063337606ea4020dd3003800c4cc18ccdd81ba9003374c0046600c00c00282f105e0c18000505e1bae3058001375660b200260b600282ca444653001001802400d0011112cc00400a200319800801cc18000a6600860be004002801905d48896600200514c103d87a80008acc004c1180062607e660b660b800497ae08cc00400e60ba0053033001400c82b105a244444664530012300300191801000cc00c00d222329800800c10e0714bd6f7b63052000a400080088888896600200b15980080244cc1a0dd3001998341ba800233068375000297ae08a998322492e4261746368206465706f73697420696e74656e74205554784f73206e6f742066756c6c792070726f6365737365640016419d13322332259800982d18349baa0018acc004cdc79bae306d306a37540020ad159800804454cc1a1241234d6f7265205554784f7320617265207370656e74207468616e20737065636966696564001689919912cc004c168c1b0dd500144cc8966002003159800982e18371baa0018992cc0040060d513259800800c4c96600200306c8992cc0040060db13259800983c001c4c96600260c460e86ea8016264b300100183844c96600200313259800800c1ca264b30010018acc004c1f400a330010038992cc004c19c006264b300100183ac4c96600200315980098400080144c96600260d400313259800800c1e2264b30010018acc004c20c0400a33001001805c1e502941e50800141e60f307983ca1080230810100141fc60fa6ea800a2b3001306d0018992cc0040060f113259800800c1e60f3079899912cc0040060f713259800800c1f20f907c899912cc0040060fd13259800800c1fe0ff07f8992cc004c2280400e02508001421c046eb40060fe845008c21c04005085011bad00130860100283e210e023084010014208046eb4004c20c0400a0f2842008c2040400507f183e9baa00283ba0f441e860f66ea80060ec83ea0ed07683b41d908101183f000a0f8307a37540051598009835000c56600260f46ea800a00d07441ed07441dc83b8c1e0dd5000c1cd02341cd07a41ce0e7073839a0fc307b00141e460f6005071838c1c60e283e0c1e4005077183a9baa005837a0e413305f001225980080144c8c8c8c966002b30013370f3001375660b060f46ea803607d488100415c00313375e60fa60f46ea8034c1f4012294107746600201d329800800cc074062603a008800888966002005100189919914c00401a61080200b32330010010052259800800c4cc21004cdd81ba9004374c00697adef6c608994c004dd7184100800cdd5984180800cc21c040092225980099b900080038998440099bb037520106e9801c0162b30013371e01000713259800983a1843009baa0018998448099bb03752012611402610e026ea800400a2004842008c1b0cc22004dd3194c0040066054011302a0034004444b30010028800c4c8cc8a600200d3090010059919800800802912cc0040062661200266ec0dd48021ba80034bd6f7b63044ca60026eb8c238040066eb4c23c040066126020049112cc004cdc8004001c4cc25004cdd81ba9008375000e00b15980099b8f0080038992cc004c20004c24804dd5000c4cc25404cdd81ba90093096013093013754002005100242400460f066128026ea0cdc000380125eb822661280266ec0dd48019ba800233006006001423c048478086122020028478090061bae308901001375a6114020026118020048450092f5c113308801337606ea400cdd300119803003000a10602420c04308501001420c048030dd7183e8009bab307e00130800100241f93370002c0053370000202a80922a660f092011f4465706f73697420696e74656e74206f757470757420696e636f7272656374001641dcb30013066039899b82001074899b8333704002072604a04883b2600200348002453001375660f400500191192cc004c1a8c1f0dd5000c4cdc000119b82375a61000260fa6ea8004dd6983e801c54cc1ed2416b65787065637420536f6d6528707269636529203d0a2020202020202020202020207072696365730a20202020202020202020202020207c3e2070616972732e6765745f66697273742828706f6c6963795f706169722e3173742c2061737365745f706169722e3173742929001641e864646600200206a44b30010018a60103d87a80008992cc004cdd79ba7004307f001898331984100984000800a5eb8226600600661080200483e8c20804005080011983f183d8021983f183d80125eb81021203e375660f460f600260ec6ea802226464b300100183941ca0e5072899912cc0040060e9133065375600244b30010028980398400080444c8c96600200307883c41e20f11332259800800c1ea0f507a89918031842808039bad00183d210a02375c00260fc004841808c1f0004c1fc00907d41d20e907441fc6eb8004c1e000907d183b000983c80120ee83720ea375600306d836c1b5078183a800a0e63075002835c1ae0d706b41d860e60028388c1bcdd5000c1a506c41a60d3069834a0e83070306d375400464b3001303d306d375400313071306e3754003153306c49013265787065637420496e6c696e65446174756d287261775f646174756d29203d20696e7075742e6f75747075742e646174756d001641ac60e060e260e260da6ea8c1c0c1c4c1b4dd5003c54cc1ad24013865787065637420536f6d65286f75745f7574786f29203d206f757470757473207c3e206c6973742e6174286f75747075745f696e64657829001641a8660180a400260de0126eb4c1b402106b466002011007803401500220ce8cc00402200f006802a004419c4445300100c802c012007002800a018306b3068375460d660d06ea8c118c1a0dd500118348029835002a0ce1802002180180196600266e2403c0522900044cdc199b82300101401348320050521b8100e825a0aa375a00304a416060aa0028298dd7000982a00120aa30520014140609c6ea800e08a825a26464b3001001823c11e26644b3001001824c12609313259800801c12a264b3001001825c12e09704b899912cc00400609b13259800800c13a09d04e82744c96600260b80071300b305c00c827a0b2375c00282e0c1640050571bae0013058004416460ac00682a0dd6800c1250571bac0013050002823c11d05518270009828801209e821a09a821c10e0870434144609c0028260dd580098268014102081040413860960028248dd6800982500140f504b1824000a08c3044375400303b410503b81dc0ee0768248c118c10cdd5003454cc1052413465787065637420536f6d65287369676e65645f6461746129203d2063626f722e646573657269616c697365286d6573736167652900164100303e303e001303d001303c001303b001303a303a002303437540046e0120028152002222598009811981a9baa0038992cc00400600513259800800c00e007003801c4cc89660020030058992cc00400600d006803401a26644b300100180444c966002003009804c4cc896600200300b8992cc00400601900c80644cc896600200300e8992cc00400601f00f807c4cc89660020030118992cc00400602501280944cc89660020030148992cc00400602b01580ac05626644b300100180bc4c96600200301880c406226644b300100180d44c96600200301b80dc06e0371332259800800c076264b300100180f407a03d01e899912cc00400604113259800800c086043021810c4cc89660020030238992cc0040060490248124092264b3001305e00389982280e112cc00400a05113259800800c0a205102881444c8c00cc188010dd7000a0c4305f0024175025416c6eb800505e182d800a0b2375c00260b400482d8c1600050561bae0013057002416060aa0028298dd7000982a00120aa305200141406eb4004c14400a0308290c13c00504d1bae001304e002413c60980028250dd68009825801404904c1824800a08e375a002609000500f4124608c0028220dd6800982280140310461821800a08237580026084005009804a086304000140f86eb8004c0fc009040181e800a076375c002607800481e8c0e8005038181b1baa003800a066814c0a605302940e064b30013002303237540031303630333754003153303149013265787065637420496e6c696e65446174756d287261775f646174756d29203d20696e7075742e6f75747075742e646174756d001640c0606a606c606c60646ea8c040c0c8dd50041b874801044464b30010038991919911980480119b8a488101280059800800c4cdc52441035b5d2900006899b8a489035b5f20009800800ccdc52441025d2900006914c00402a00530070014029229800805400a0028051010206c5980099b880014803a266e0120f2010018acc004cdc4000a41000513370066e01208014001480362c81810301bac3033002375a60620026466ec0dd418188009ba73032001375400713259800800c4cdc52441027b7d00003899b8a489037b5f20003232330010010032259800800c400e264b30010018994c00402a606c003337149101023a200098008054c0dc00600a805100a181c80144ca6002015303600199b8a489023a200098008054c0dc006600e66008008004805100a181c801206e303900140d866e29220102207d0000340cc6eac00e264b3001001899b8a489025b5d00003899b8a489035b5f20009800800ccdc52441015d00003914c00401e0053004001401d229800803c00a002803900d20663758007133005375a0060051323371491102682700329800800cc034dc68014cdc52450127000044004444b300133710004900044006264664530010069809002ccdc599b800025980099b88002480522903045206e40d466e2ccdc0000acc004cdc4000a402914818229037206a004401866e0c00520203370c002901019b8e00400240c86eb800d0361b8a4881022c20002232330010010032259800980e800c4cdc52450130000038acc004cdc4000a40011337149101012d0033002002337029000000c4cc014cdc2000a402866e2ccdc019b8500148051206000340b4816840783301d0093301d374e64646600200200844b30010018a5eb8226644b30015980099baf30233020375400400b1323300100132330010013756604a604c60446ea8010896600200314bd7044c8cc88c8cc004004dd59813802112cc00400620071323302b374e660566ea4014cc0acc0a0004cc0acc0a40052f5c066006006605a00460560028148dd718118009980180198140011813000a0482259800800c528456600266e3cdd718129bac302500100e8a518998010011813000a03e408d14a080ea2660440046600800800313300400400140746042002604400280f8c004cc074cdd2a40046603a6ea401d2f5c06603a980103d87a80004bd7025eb80dd6180e0009ba548000c070004c06c004c058dd5002980a9baa00422323300100100322330030013002002805402a01500a40686eb8c05cc050dd50034590111b87480010100c044c048004c044004c030dd500945268a9980524811856616c696461746f722072657475726e65642066616c7365001365640241"; // Using index 0 for deposit intent spend
    blueprint
        .param_script(
            compiled_code,
            &[
                &byte_string(oracle_nft).to_string(),
                &integer(lp_decimal).to_string(),
            ],
            BuilderDataType::JSON,
        )
        .unwrap();
    Ok(blueprint)
}

#[cfg(test)]
mod tests {

    use super::*;
    use dotenv::dotenv;

    #[test]
    fn test_deposit_intent_mint_blueprint() {
        dotenv().ok();

        let blueprint = deposit_intent_mint_blueprint(
            "c9e99dda2af8e97d8ccde3254fc1c16926fbbf6508929dad6518d1b83f389e92",
            1000000,
        )
        .unwrap();
        println!("blueprint: {:?}", blueprint);
        assert_eq!(blueprint.hash, "TODO");
        assert_eq!(blueprint.cbor, "TODO");
    }

    #[test]
    fn test_deposit_intent_spend_blueprint() {
        dotenv().ok();

        let blueprint = deposit_intent_spend_blueprint("todo", 1000000).unwrap();
        assert_eq!(blueprint.hash, "TODO");
        assert_eq!(blueprint.cbor, "TODO");
    }
}
